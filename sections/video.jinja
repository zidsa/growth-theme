{% set is_lazy = settings.order > 2 %}

<section
  section-id="{{ sectionId }}"
  class="bg-black px-4 py-8 md:px-16 md:py-12"
>
  {% if settings.video %}
    <div class="video-wrapper theme-container relative">
      <video
        class="w-full rounded-lg"
        style="max-height: 80vh; object-fit: contain"
        loop
        playsinline
        muted
        {% if settings.poster_image %}poster="{{ image_url(settings.poster_image, w=1280, q=70, f='auto') }}"{% endif %}
        {% if settings.autoplay %} autoplay {% endif %}
        {% if is_lazy %} preload="none"{% else %} preload="metadata" {% endif %}
      >
        <source
          src="{{ settings.video }}"
          type="video/mp4"
        />
        Your browser does not support the video tag.
      </video>
      {% if not settings.autoplay %}
        <div
          class="video-overlay absolute inset-0 flex flex-col items-center justify-center space-y-6 rounded-lg bg-black/30 text-center transition-opacity duration-500"
        >
          {% if settings.title %}
            <h2 class="text-2xl md:text-3xl font-semibold tracking-tight text-white">{{ settings.title }}</h2>
          {% endif %}
          <button class="play-button bg-background text-accent rounded-full p-4">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
            >
              <path
                d="M28.5453 13.3708C29.1857 13.7114 29.7214 14.2197 30.0949 14.8415C30.4685 15.4632 30.6658 16.1748 30.6658 16.9001C30.6658 17.6255 30.4685 18.3371 30.0949 18.9588C29.7214 19.5806 29.1857 20.0889 28.5453 20.4295L11.4627 29.7188C8.712 31.2162 5.33333 29.2695 5.33333 26.1908V7.61082C5.33333 4.53082 8.712 2.58548 11.4627 4.08015L28.5453 13.3708Z"
                fill="currentColor"
              ></path>
            </svg>
          </button>
        </div>
      {% endif %}
    </div>
  {% endif %}
  {% if not settings.autoplay and settings.video %}
    <script>
      (function () {
        const section = document.querySelector('[section-id="{{ sectionId }}"]');
        const video = section.querySelector("video");
        const overlay = section.querySelector(".video-overlay");
        const playButton = section.querySelector(".play-button");

        if (playButton && video && overlay) {
          playButton.addEventListener("click", function () {
            video.play();
            overlay.style.opacity = "0";
            setTimeout(() => {
              overlay.style.display = "none";
            }, 500);
          });
        }
      })();
    </script>
  {% endif %}
</section>
