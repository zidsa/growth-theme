{#
  Quantity Input Component

  A quantity control with +/- buttons.

  Props:
    - product_id (string, optional): Product ID for cart operations (enables cart mode)
    - quantity (number, optional): Current quantity (default: 1)
    - min (number, optional): Minimum quantity (default: 1)
    - max (number, optional): Maximum quantity (default: none)
    - mode (string, optional): 'cart' or 'product' (default: 'cart')
      - cart: Shows delete icon at qty=1, uses data attributes for cart.js
      - product: Shows minus icon, uses input field for product page

  Usage (cart mode - product cards):
    {% with product_id=product.id, quantity=1 %}
      {% include 'components/ui/quantity-input.jinja' %}
    {% endwith %}

  Usage (product mode - product page):
    {% with mode='product', quantity=1, min=1, max=product.quantity %}
      {% include 'components/ui/quantity-input.jinja' %}
    {% endwith %}
#}

{% set qty = quantity | default(1) %}
{% set min_qty = min | default(1) %}
{% set max_qty = max %}
{% set has_max = max is not none and max %}
{% set input_mode = mode | default('cart') %}

{# Icon definitions #}
{% set delete_icon %}
  <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M11.3333 6V12.6667H4.66667V6H11.3333ZM10.1667 2H5.83333L5 2.83333H2V4.5H14V2.83333H11L10.1667 2ZM13 4.33333H3V12.6667C3 13.5833 3.75 14.3333 4.66667 14.3333H11.3333C12.25 14.3333 13 13.5833 13 12.6667V4.33333Z"
      fill="currentColor"
    />
  </svg>
{% endset %}

{% set minus_icon %}
  <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4 7.44444V8.55556H12V7.44444H4Z" fill="currentColor" />
  </svg>
{% endset %}

{% set plus_icon %}
  <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M12.6667 8.66667H8.66667V12.6667H7.33333V8.66667H3.33333V7.33333H7.33333V3.33333H8.66667V7.33333H12.6667V8.66667Z"
      fill="currentColor"
    />
  </svg>
{% endset %}

{% if input_mode == 'product' %}
  {# Product page mode - input field, w-fit, inline handlers #}
  <div class="qty-input w-fit">
    <button
      type="button"
      class="qty-input-btn"
      data-quantity-action="decrease"
      aria-label="{{ _('Decrease quantity') }}"
    >
      {{ minus_icon }}
    </button>

    <input
      type="number"
      id="product-quantity"
      name="quantity"
      value="{{ qty }}"
      min="{{ min_qty }}"
      {% if has_max %}max="{{ max_qty }}"{% endif %}
      class="qty-input-field"
      aria-label="{{ _('Quantity') }}"
      data-quantity-display
    />

    <button
      type="button"
      class="qty-input-btn"
      data-quantity-action="increase"
      aria-label="{{ _('Increase quantity') }}"
    >
      {{ plus_icon }}
    </button>
  </div>
{% else %}
  {# Cart mode - span display, delete at qty=1, data attributes #}
  <div
    class="qty-input qty-input-full"
    data-quantity-input
    data-product-id="{{ product_id }}"
    data-quantity="{{ qty }}"
  >
    {# Delete button (visible when qty = 1) #}
    <button
      type="button"
      class="qty-input-btn"
      aria-label="{{ _('Remove from cart') }}"
      data-quantity-action="remove"
      {{ 'hidden' if qty > 1 else '' }}
    >
      {{ delete_icon }}
    </button>

    {# Minus button (visible when qty > 1) #}
    <button
      type="button"
      class="qty-input-btn"
      aria-label="{{ _('Decrease quantity') }}"
      data-quantity-action="decrease"
      {{ 'hidden' if qty == 1 else '' }}
    >
      {{ minus_icon }}
    </button>

    {# Quantity display #}
    <span class="qty-input-display" data-quantity-display>{{ qty }}</span>

    {# Plus button #}
    <button
      type="button"
      class="qty-input-btn"
      aria-label="{{ _('Increase quantity') }}"
      data-quantity-action="increase"
    >
      {{ plus_icon }}
    </button>
  </div>
{% endif %}
